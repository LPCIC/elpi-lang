{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Elpi",
	"patterns": [
		{
			"include": "#comments"
		},
		{
			"include": "#namespace-declaration"
		},
		{
			"include": "#clause-declaration"
		},
		{
			"include": "#type-declaration"
		},
		{
			"include": "#kind-declaration"
		},
		{
			"include": "#pred-declaration"
		},
		{
			"include": "#macro-declaration"
		},
		{
			"include": "#attribute-declaration"
		},
		{
			"include": "#mode-declaration"
		},
		{
			"include": "#rule-declaration"
		},
		{
			"include": "#constraint-declaration"
		},
		{
			"include": "#accumulate-declaration"
		},
		{
			"include": "#shorten-declaration"
		},
		{
			"include": "#variables"
		},
		{
			"include": "#strings"
		},
		{
			"include": "#numbers"
		},
		{
			"include": "#keywords"
		},
		{
			"include": "#comments"
		},
		{
			"include": "#clause-def-ident"
		}
	],
	"repository": {
		"comments": {
			"patterns": [
				{
					"name": "comment.block.elpi",
					"begin": "/\\*",
					"end": "\\*/"
				},
				{
					"name": "comment.line.percentage.elpi",
					"match": "%.*$"
				}
			]
		},
		"attribute-declaration": {
			"name": "attribute.declaration",
			"patterns": [
				{
					"match": ":if\\s+\"\\S+\"",
					"name": "entity.name.tag"
				},
				{
					"match": ":name\\s+\"\\S+\"",
					"name": "entity.name.tag"
				},
				{
					"match": ":before\\s+\"\\S+\"",
					"name": "entity.name.tag"
				},
				{
					"match": ":after\\s+\"\\S+\"",
					"name": "entity.name.tag"
				},
				{
					"include": "#indexing-declaration"
				}
			]
		},
		"indexing-declaration": {
			"begin": "(:index)\\s*\\(",
			"end": "\\)",
			"beginCaptures": {
				"1": {
					"name": "entity.name.tag"
				}
			},
			"patterns": [
				{
					"match": "_|[0-9]",
					"name": "constant.numeric"
				}
			]
		},
		"constraint-declaration": {
			"begin": "^\\s*(constraint)([^{]+)",
			"end": "{",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				},
				"2": {
					"name": "entity.name.function"
				}
			}
		},
		"rule-declaration": {
			"begin": "^\\s*(rule)",
			"end": "(\\.)\\s",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"endCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"patterns": [
				{
					"include": "$self"
				}
			]
		},
		"accumulate-declaration": {
			"begin": "^\\s*(accumulate)",
			"end": "(\\.)\\s",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"endCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"patterns": [
				{
					"include": "#strings"
				}
			]
		},
		"pred-declaration": {
			"name": "pred.declaration",
			"begin": "^((external)?\\s*pred)\\s+([a-z!-']([a-zA-Z!_'\\-0-9><?]|\\.[a-z!-'])*|\\(\\S+\\))",
			"end": "(\\.)\\s",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				},
				"2": {
					"name": "keyword.control.elpi"
				},
				"3": {
					"name": "entity.name.function"
				}
			},
			"endCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"patterns": [
				{
					"include": "#mode"
				},
				{
					"include": "#comments"
				},
				{
					"include": "#type-expr"
				}
			]
		},
		"mode-declaration": {
			"name": "mode.declaration",
			"begin": "^(\\s*mode)\\s+\\((([a-z!-']([a-zA-Z!_']|\\.[a-z!-'])*)|(\\(\\S+\\))+)\\s",
			"end": "([io\\s]+)\\)\\s*(\\.)\\s",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				},
				"2": {
					"name": "entity.name.function"
				}
			},
			"endCaptures": {
				"2": {
					"name": "keyword.control.elpi"
				},
				"1": {
					"name": "entity.name.tag"
				}
			},
			"patterns": []
		},
		"kind-declaration": {
			"name": "kind.declaration",
			"begin": "^((external)?\\s*kind)\\s+(([a-z!-']([a-zA-Z!_']|\\.[a-z!-'])*)|(\\(\\S+\\))+)",
			"end": "(\\.)\\s",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				},
				"2": {
					"name": "keyword.control.elpi"
				},
				"3": {
					"name": "entity.name.type"
				}
			},
			"endCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"patterns": [
				{
					"match": "type",
					"name": "entity.name.type"
				}
			]
		},
		"type-declaration": {
			"name": "type.declaration",
			"begin": "^((external)?\\s*type)\\s+(([a-z!-']([a-zA-Z!_']|\\.[a-z!-'])*)|(\\(\\S+\\))+)",
			"end": "(\\.)\\s",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				},
				"2": {
					"name": "keyword.control.elpi"
				},
				"3": {
					"name": "entity.name.function"
				}
			},
			"endCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"patterns": [
				{
					"include": "#comments"
				},
				{
					"include": "#type-expr"
				}
			]
		},
		"macro-declaration": {
			"name": "macro.declaration",
			"begin": "^\\s*(macro)\\s+(@[a-z]\\S*)\\s",
			"end": "(\\.)\\s",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				},
				"2": {
					"name": "entity.name.type"
				}
			},
			"endCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"patterns": [
				{
					"include": "$self"
				}
			]
		},
		"shorten-declaration": {
			"begin": "^\\s*(shorten)",
			"end": "(\\.)\\s",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"endCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				}
			},
			"patterns": [
				{
					"include": "#shortening-expr"
				}
			]
		},
		"shortening-expr": {
			"begin": "\\b([a-z][a-zA-Z_!0-9\\-\\.]*)\\b\\.{",
			"end": "}",
			"beginCaptures": {
				"1": {
					"name": "entity.name.section"
				}
			},
			"patterns": [
				{
					"include": "#shortening-expr"
				},
				{
					"match": "\\b[a-z][a-zA-Z_!0-9\\-\\.]*\\b",
					"name": "entity.name.function"
				}
			]
		},
		"type-expr": {
			"patterns": [
				{
					"match": "prop|list|string|int|float|any|variadic|@[a-z_\\-0-9]+",
					"name": "entity.name.type"
				},
				{
					"include": "#comments"
				},
				{
					"include": "#variables"
				}
			]
		},
		"mode": {
			"patterns": [
				{
					"match": "\\b(i:|o:)",
					"name": "entity.name.tag"
				}
			]
		},
		"namespace-declaration": {
			"begin": "^\\s*(namespace)\\s\\b([a-z][a-zA-Z_!0-9\\-\\.]*)\\b\\s*{",
			"end": "}",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.elpi"
				},
				"2": {
					"name": "entity.name.section"
				}
			},
			"patterns": [
				{
					"include": "#comments"
				},
				{
					"include": "$self"
				}
			]
		},
		"variables": {
			"patterns": [
				{
					"match": "\\b[_A-Z][a-zA-Z0-9_'?]*\\b",
					"name": "variable.language.elpi"
				}
			]
		},
		"strings": {
			"name": "string.quoted.double.elpi",
			"begin": "\"",
			"end": "\"",
			"patterns": [
				{
					"name": "constant.character.escape.elpi",
					"match": "\\\\."
				}
			]
		},
		"numbers": {
			"patterns": [
				{
					"name": "constant.numeric.elpi",
					"match": "\\b[0-9][0-9\\.]*\\b"
				}
			]
		},
		"keywords": {
			"patterns": [
				{
					"name": "keyword.control.elpi",
					"match": "!|:-|=>|\\[|\\]|,|\\bis\\b|\\bpi\\b|\\bsigma\\b|<=>|=|\\?\\-|\\\\|\\|"
				}
			]
		},
		"clause-def-ident": {
			"match": "^[a-z][a-zA-Z0-9_'?\\.-]*",
			"name": "entity.name.function"
		}
	},
	"scopeName": "source.elpi"
}